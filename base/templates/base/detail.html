{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'base/style.css' %}"> 

<header class="header"><div class="header_midle"><span class="header_text"><b>Заявка №{{ ticket.id }} от {{ ticket.ticket_date }} {% if no_object_message %} {{ no_obj_messge }} {% else %}  на объект: {{ ticket_object.obj_number }} {% endif %}</b></div></span></header>
<div class="menu">Меню: |<a href="{% url 'base:ticket_index' %}">К списку заявок</a>|<a href="{% url 'base:new_ticket' %}">Создать заявку</a>|</div>
<div class="demo-ribbon"></div> 

<div class="index_table">
<div class="ticket_row"><b>По адресу:</b>
{% if ticket.obj_area %}{{ ticket_object.obj_area }} р-н, {% endif %}
ул {{ ticket.ticket_str }}, 
дом {{ ticket.ticket_build }}, 
{% if ticket.ticket_build_housing %} корпус {{ ticket.ticket_build_housing }}, {% endif %}
парадная {{ ticket.ticket_par }},
{% if ticket.ticket_object.obj_type %}
тип лифта: {{ ticket.ticket_object.obj_type }}.
{% endif %}
</div>
<div class="ticket_row"><b>Открыта:</b> {{ ticket.ticket_date|timesince }} назад</div>
<div class="ticket_row"><b>Статус:</b> {% if ticket_message %}{{ ticket_message }}{% else %}{{ ticket.ticket_status }}{% endif %}</div>

{% if ticket.ticket_status.id == 1 %}
<form action="{% url 'base:ticket_close' ticket.id %}" method="post">
{% csrf_token %}

{% if exact_message %}<div class="ticket_row">{{ exact_message }}</div>{% endif %}

{% if object_exact %}
    <div class="new_ticket_row"><input list="object_exact" name="obj_exact" placeholder="Тип лифта" size="20">
    <datalist id="object_exact">
    {% for obj in object_exact %}
        <option>{{ obj.obj_type }}</option>
    {% endfor %}
    </datalist>
    </div>
    <input type="submit" value="Закрыть заявку">
{% endif %}

{% if error_message %}<p style='color:red'><b> {{ error_message }} </b></p>{% endif %}
</form>
{% endif %}


<div class="ticket_row"><b>Время простоя:</b> {{ ticket.ticket_duration|default_if_none:ticket.ticket_date|timesince }}</div>
<div class="ticket_row"><b>Содержание:</b>{{ ticket.ticket_content }}</div>

<div><b>Комментарии:</b></div>
<div>
{% for comment in ticket.comments_set.all|dictsort:"comment_date" %}
    <div class="new_ticket_row"><span class="comment_num">№{{ forloop.counter }}</span> от <span class="comment_user">{{ comment.comment_user }}</span> оставлен <span class="comment_date">{{ comment.comment_date }}</span></br><span class="comment_date">{{ comment.comment_content }}</span></div>
{% empty %}
    <span class="">Пока нет ни одного комментария</p>
{% endfor %}
</div>

<form action="{% url 'base:ticket_detail' ticket.id %}" method="post">
{% if errormessage %}<p style="color:red"><b>{{ errormessage }}</b></p>{% endif %}
{% if message %}<p style="color:grey"><b>{{ message }}</b></p>{% endif %}
{% csrf_token %}
<div class="new_ticket_row"><textarea name="comment_content" required placeholder="Текст комментария" cols="60" rows="2"></textarea></div>
<input class="send_button" type="submit" value="Отправить">
</form>

</div>